<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Photo Caption Generator Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Included 50 Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700;800&family=Montserrat:wght@100;200;300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Raleway:wght@100;200;300;400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Lato:wght@100;300;400;700;900&family=Oswald:wght@200;300;400;500;600;700&family=Source+Sans+3:wght@200;300;400;500;600;700;800;900&family=Merriweather:wght@300;400;700;900&family=Nunito:wght@200;300;400;500;600;700;800;900&family=Quicksand:wght@300;400;500;600;700&family=Rubik:wght@300;400;500;600;700;800;900&family=Work+Sans:wght@100;200;300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&family=Archivo:wght@100;200;300;400;500;600;700;800;900&family=Fira+Sans:wght@100;200;300;400;500;600;700;800;900&family=Noto+Sans:wght@100;200;300;400;500;600;700;800;900&family=PT+Sans:wght@400;700&family=Roboto+Condensed:wght@300;400;700&family=Ubuntu:wght@300;400;500;700&family=Zilla+Slab:wght@300;400;500;600;700&family=Cabin:wght@400;500;600;700&family=Exo+2:wght@100;200;300;400;500;600;700;800;900&family=Josefin+Sans:wght@100;200;300;400;500;600;700&family=Karla:wght@200;300;400;500;600;700;800&family=Lora:wght@400;500;600;700&family=Manrope:wght@200;300;400;500;600;700;800&family=Overpass:wght@100;200;300;400;500;600;700;800;900&family=Prompt:wght@100;200;300;400;500;600;700;800;900&family=Red+Hat+Display:wght@300;400;500;600;700;800;900&family=Sora:wght@100;200;300;400;500;600;700;800&family=Titillium+Web:wght@200;300;400;600;700;900&family=Varela+Round&family=Arvo:wght@400;700&family=DM+Sans:wght@400;500;700&family=Epilogue:wght@100;200;300;400;500;600;700;800;900&family=Hanken+Grotesk:wght@100;200;300;400;500;600;700;800;900&family=IBM+Plex+Sans:wght@100;200;300;400;500;600;700&family=Lexend:wght@100;200;300;400;500;600;700;800;900&family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700;800&family=Syne:wght@400;500;600;700;800&family=Be+Vietnam+Pro:wght@100;200;300;400;500;600;700;800;900&family=Figtree:wght@300;400;500;600;700;800;900&family=Geologica:wght@100;200;300;400;500;600;700;800;900&family=Onest:wght@100;200;300;400;500;600;700;800;900&family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --background-dark: #1a1a1a;
            --text-light: #f8fafc;
            --text-dark: #1e293b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-dark);
            color: var(--text-light);
            min-height: 100vh;
            padding: 2rem;
        }

        .auth-container {
            max-width: 400px;
            margin: 5rem auto;
            background: #2d2d2d;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .auth-toggle {
            margin: 1rem 0;
            text-align: center;
            color: var(--primary-color);
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        input, select, button {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #374151;
            background: #374151;
            color: var(--text-light);
            font-size: 1rem;
        }

        button {
            background: var(--primary-color);
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }

        .toolbar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .preview-container {
            position: relative;
            max-width: 800px;
            margin: 2rem auto;
            border: 2px dashed #4b5563;
            border-radius: 1rem;
            overflow: hidden;
        }

        #imageCanvas {
            max-width: 100%;
            display: none;
        }

        .caption-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .photo-card {
            background: #2d2d2d;
            border-radius: 0.5rem;
            overflow: hidden;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #ef4444;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div class="auth-container" id="authContainer">
        <h2 class="text-center">Register/Login</h2>
        <form id="authForm" onsubmit="return handleAuth(event)">
            <div class="form-group">
                <input type="text" id="username" placeholder="Username" required>
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Password" required>
            </div>
            <div class="form-group">
                <select id="authType">
                    <option value="register">Register</option>
                    <option value="login">Login</option>
                </select>
            </div>
            <button type="submit">Continue</button>
        </form>
        <div class="auth-toggle" onclick="toggleAuthType()">Switch to Login</div>
    </div>

    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <div class="toolbar">
            <input type="file" id="imageUpload" accept="image/*">
            <button onclick="generateCaption()">Generate Caption</button>
        </div>

        <div class="caption-controls">
            <select id="fontSelect"></select>
            <input type="color" id="colorSelect" value="#ffffff">
            <input type="number" id="fontSize" min="12" max="72" value="24">
            <select id="positionSelect">
                <option value="top-left">Top Left</option>
                <option value="top-center">Top Center</option>
                <option value="top-right">Top Right</option>
                <option value="center">Center</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="bottom-center">Bottom Center</option>
                <option value="bottom-right">Bottom Right</option>
            </select>
        </div>

        <div class="preview-container">
            <canvas id="imageCanvas"></canvas>
        </div>

        <div class="history-grid" id="historyGrid"></div>
    </div>

    <script>
        // Hardcoded API Key
        const API_KEY = 'AIzaSyBExqECRKhZKt5oec5TOVqrlLG9iDOx6Tk';

        // Initialize fonts
        const fonts = [
            'Roboto', 'Open Sans', 'Montserrat', 'Playfair Display', 'Poppins',
            'Raleway', 'Inter', 'Lato', 'Oswald', 'Source Sans 3', 'Merriweather',
            'Nunito', 'Quicksand', 'Rubik', 'Work Sans', 'Space Mono', 'Archivo',
            'Fira Sans', 'Noto Sans', 'PT Sans', 'Roboto Condensed', 'Ubuntu',
            'Zilla Slab', 'Cabin', 'Exo 2', 'Josefin Sans', 'Karla', 'Lora',
            'Manrope', 'Overpass', 'Prompt', 'Red Hat Display', 'Sora', 'Titillium Web',
            'Varela Round', 'Arvo', 'DM Sans', 'Epilogue', 'Hanken Grotesk',
            'IBM Plex Sans', 'Lexend', 'Plus Jakarta Sans', 'Syne', 'Be Vietnam Pro',
            'Figtree', 'Geologica', 'Onest', 'Outfit'
        ];

        // Initialize font selector
        const fontSelect = document.getElementById('fontSelect');
        fonts.forEach(font => {
            const option = document.createElement('option');
            option.value = font;
            option.textContent = font;
            fontSelect.appendChild(option);
        });

        // User management
        let currentUser = null;

        function handleAuth(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const authType = document.getElementById('authType').value;

            const users = JSON.parse(localStorage.getItem('users') || '{}');

            if (authType === 'register') {
                if (users[username]) {
                    alert('Username already exists!');
                    return;
                }
                users[username] = { password: password, data: [] };
            } else {
                if (!users[username] || users[username].password !== password) {
                    alert('Invalid credentials!');
                    return;
                }
            }

            currentUser = username;
            localStorage.setItem('currentUser', username);
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            loadHistory();
        }

        // Caption generation and image handling
        async function generateCaption() {
            const canvas = document.getElementById('imageCanvas');
            const imageData = canvas.toDataURL();
            
            const style = {
                font: document.getElementById('fontSelect').value,
                color: document.getElementById('colorSelect').value,
                size: document.getElementById('fontSize').value + 'px',
                position: document.getElementById('positionSelect').value
            };

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a creative social media caption for this image`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                const caption = data.candidates[0].content.parts[0].text;
                applyCaption(caption, style);
                saveToHistory(imageData, caption, style);
            } catch (error) {
                alert('Error generating caption: ' + error.message);
            }
        }

        function applyCaption(caption, style) {
            const canvas = document.getElementById('imageCanvas');
            const ctx = canvas.getContext('2d');
            
            // Redraw image
            const img = new Image();
            img.src = canvas.toDataURL();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // Apply text styling
                ctx.fillStyle = style.color;
                ctx.font = `${style.size} ${style.font}`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // Calculate position
                let x, y;
                switch(style.position) {
                    case 'top-left': x = 50; y = 50; ctx.textAlign = 'left'; break;
                    case 'top-center': x = canvas.width/2; y = 50; break;
                    case 'top-right': x = canvas.width-50; y = 50; ctx.textAlign = 'right'; break;
                    case 'center': x = canvas.width/2; y = canvas.height/2; break;
                    case 'bottom-left': x = 50; y = canvas.height-50; ctx.textAlign = 'left'; break;
                    case 'bottom-center': x = canvas.width/2; y = canvas.height-50; break;
                    case 'bottom-right': x = canvas.width-50; y = canvas.height-50; ctx.textAlign = 'right'; break;
                }

                // Add text background
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                const textMetrics = ctx.measureText(caption);
                ctx.fillRect(
                    x - textMetrics.width/2 - 10,
                    y - parseInt(style.size)/2 - 5,
                    textMetrics.width + 20,
                    parseInt(style.size) + 10
                );

                // Draw text
                ctx.fillStyle = style.color;
                ctx.fillText(caption, x, y);
            };
        }

        // History management
        function saveToHistory(imageData, caption, style) {
            const users = JSON.parse(localStorage.getItem('users'));
            users[currentUser].data.push({
                imageData,
                caption,
                style,
                date: new Date().toISOString()
            });
            localStorage.setItem('users', JSON.stringify(users));
            loadHistory();
        }

        function loadHistory() {
            const users = JSON.parse(localStorage.getItem('users'));
            const historyGrid = document.getElementById('historyGrid');
            historyGrid.innerHTML = users[currentUser].data.map((item, index) => `
                <div class="photo-card">
                    <canvas class="history-canvas" data-image="${item.imageData}" 
                            data-caption="${item.caption}" 
                            data-style='${JSON.stringify(item.style)}'></canvas>
                    <button class="delete-btn" onclick="deletePhoto(${index})">Delete</button>
                </div>
            `).join('');
        }

        function deletePhoto(index) {
            const users = JSON.parse(localStorage.getItem('users'));
            users[currentUser].data.splice(index, 1);
            localStorage.setItem('users', JSON.stringify(users));
            loadHistory();
        }

        // Initialization
        window.onload = () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                loadHistory();
            }
        };

        // Utility functions
        function toggleAuthType() {
            const authType = document.getElementById('authType');
            authType.value = authType.value === 'login' ? 'register' : 'login';
            document.querySelector('.auth-toggle').textContent = 
                `Switch to ${authType.value === 'login' ? 'Register' : 'Login'}`;
        }
    </script>
</body>
</html>
